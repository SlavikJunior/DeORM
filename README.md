
# DeORM

Простая и легковесная ORM (Object-Relational Mapping) библиотека для **Kotlin**.

---

## Возможности

- **CRUD операции** — создание, чтение, обновление и удаление сущностей  
- **Автоматическое маппинг** — преобразование между объектами Kotlin и таблицами БД  
- **Простой API** — интуитивно понятный интерфейс для работы с данными  
- **Типобезопасность** — работа с типами Kotlin вместо сырых SQL-запросов  
- **Поддержка PostgreSQL** — работа через JDBC-драйвер  
- **Аннотации для маппинга** — удобное определение сущностей

---

## Структура

```bash
src
└── main
    └── kotlin
        └── com
            └── slavikjunior
                └── deorm
                    ├── annotations
                    │   └── Annotations.kt
                    ├── dao
                    │   ├── Dao.kt
                    │   └── UniversalDao.kt
                    ├── db_manager
                    │   └── DbConnectionManager.kt
                    ├── exceptions
                    │   └── Exceptions.kt
                    ├── orm
                    │   ├── CrudImpl.kt
                    │   ├── Crud.kt
                    │   ├── Entity.kt
                    │   ├── EntityManager.kt
                    │   └── QueryBuilder.kt
                    ├── Person.kt
                    ├── Playground.kt
                    └── utils
                        └── KotlinExtensions.kt

```

---

## Подключение

> Пока библиотека не опубликована в Maven Central, можно скачать JAR из страницы **Releases** и подключить вручную.

#### Maven

```xml
<dependencies>
    <!-- DeORM -->
    <dependency>
        <groupId>com.slavikjunior</groupId>
        <artifactId>deorm</artifactId>
        <version>1.0.0</version>
        <scope>system</scope>
        <systemPath>${project.basedir}/libs/deorm.jar</systemPath>
    </dependency>

    <!-- PostgreSQL драйвер -->
    <dependency>
        <groupId>org.postgresql</groupId>
        <artifactId>postgresql</artifactId>
        <version>42.7.4</version>
    </dependency>
</dependencies>
```

#### Настройка базы данных

> Создайте файл application.properties в src/main/resources/:
```bash
database.name=mydb
host=localhost
port=5432
user=postgres
password=7913
```

##### Определение сущности
```bash
import com.slavikjunior.deorm.annotations.Column
import com.slavikjunior.deorm.annotations.Id
import com.slavikjunior.deorm.annotations.Table
import com.slavikjunior.deorm.orm.Entity
import java.sql.Types

@Table(name = "persons")
data class Person(
    @Id(autogenerated = true)
    @Column(name = "id", type = Types.INTEGER, nullable = false)
    var id: Int,

    @Column(name = "first_name", type = Types.VARCHAR, nullable = false)
    var firstName: String,

    @Column(name = "last_name", type = Types.VARCHAR, nullable = false)
    var lastName: String,

    @Column(name = "phone", type = Types.VARCHAR, nullable = true)
    var phone: String? = null
) : Entity
```

# Пример использования
```bash
import com.slavikjunior.deorm.orm.EntityManager

fun main() {
    val person = Person(
        id = 0, // игнорируется, autogenerated = true
        firstName = "John",
        lastName = "Doe",
        phone = "+78126665252"
    )

    // Создание записи
    val isCreated = EntityManager.create(person)
    println("$person is created: $isCreated")

    // Поиск записи
    val found = EntityManager.get(
        Person::class.java,
        mapOf("first_name" to person.firstName, "last_name" to person.lastName)
    )?.last() as Person
    println("$person is found: $found")

    // Обновление записи
    val isUpdated = EntityManager.update(
        Person::class.java,
        id = found.id,
        columnsToValues = mapOf("first_name" to "Arthur", "last_name" to "Sharafiev")
    )

    if (isUpdated) {
        val updated = EntityManager.get(
            Person::class.java,
            mapOf("first_name" to "Arthur", "last_name" to "Sharafiev")
        )?.last() as Person

        println("$found updated: $updated")

        // Удаление записи
        val isDeleted = EntityManager.delete(updated)
        println("$updated is deleted: $isDeleted")
    }
}
```
---

# Пример вывода
```bash
Person(id=0, firstName=John, lastName=Doe, phone=+78126665252) is created: true
Person(id=0, firstName=John, lastName=Doe, phone=+78126665252) is found: Person(id=3, firstName=John, lastName=Doe, phone=+78126665252)
Person(id=3, firstName=John, lastName=Doe, phone=+78126665252) is updated: Person(id=3, firstName=Arthur, lastName=Sharafiev, phone=+78126665252)
Person(id=3, firstName=Arthur, lastName=Sharafiev, phone=+78126665252) is deleted: true
```

---

# Автор:
SlavikJunior